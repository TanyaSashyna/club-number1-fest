!function(r,t){if("function"==typeof require&&"object"==typeof exports){var e=require("openlayers");exports.angularOpenlayersDirective=t(e)}else"function"==typeof define&&define.amd?define(["ol"],function(e){return r.angularOpenlayersDirective=t(e)}):r.angularOpenlayersDirective=t(r.ol)}(this,function(O){angular.module("openlayers-directive",["ngSanitize"]).directive("openlayers",["$log","$q","$compile","olHelpers","olMapDefaults","olData",function(e,t,r,f,y,v){return{restrict:"EA",transclude:!0,replace:!0,scope:{center:"=olCenter",defaults:"=olDefaults",view:"=olView",events:"=olEvents"},template:'<div class="angular-openlayers-map" ng-transclude></div>',controller:["$scope",function(e){var r=t.defer();e.getMap=function(){return r.promise},e.setMap=function(e){r.resolve(e)},this.getOpenlayersScope=function(){return e}}],link:function(e,r,t){var o=f.isDefined,n=f.createLayer,a=f.setMapEvents,i=f.setViewEvents,l=f.createView,s=y.setDefaults(e);o(t.width)&&(isNaN(t.width)?r.css("width",t.width):r.css("width",t.width+"px")),o(t.height)&&(isNaN(t.height)?r.css("height",t.height):r.css("height",t.height+"px")),o(t.lat)&&(s.center.lat=parseFloat(t.lat)),o(t.lon)&&(s.center.lon=parseFloat(t.lon)),o(t.zoom)&&(s.center.zoom=parseFloat(t.zoom));var c=O.control.defaults(s.controls),u=O.interaction.defaults(s.interactions),p=l(s.view),d=new O.Map({target:r[0],controls:c,interactions:u,renderer:s.renderer,view:p,loadTilesWhileAnimating:s.loadTilesWhileAnimating,loadTilesWhileInteracting:s.loadTilesWhileInteracting});if(e.$on("$destroy",function(){v.resetMap(t.id)}),!t.customLayers){var g=n({type:"Tile",source:{type:"OSM"}},p.getProjection(),"default");d.addLayer(g),d.set("default",!0)}if(!o(t.olCenter)){var m=O.proj.transform([s.center.lon,s.center.lat],s.center.projection,p.getProjection());p.setCenter(m),p.setZoom(s.center.zoom)}a(s.events,d,e),i(s.events,d,e),e.setMap(d),v.setMap(d,t.id)}}}]),angular.module("openlayers-directive").directive("olCenter",["$log","$location","olMapDefaults","olHelpers",function(v,h,w,S){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(e,r,n,t){var a=S.safeApply,c=S.isValidCenter,u=S.isDefined,p=S.isArray,d=S.isNumber,g=S.isSameCenterOnMap,m=S.setCenter,f=S.setZoom,y=t.getOpenlayersScope();y.getMap().then(function(i){var o,l=w.getDefaults(y),s=i.getView(),e=y.center;if(-1!==n.olCenter.search("-"))return v.error('[AngularJS - Openlayers] The "center" variable can\'t use a "-" on his key name: "'+n.center+'".'),void m(s,l.view.projection,l.center,i);if(u(e)||(e={}),c(e)||(v.warn("[AngularJS - Openlayers] invalid 'center'"),e.lat=l.center.lat,e.lon=l.center.lon,e.zoom=l.center.zoom,e.projection=l.center.projection),e.projection||("pixel"!==l.view.projection?e.projection=l.center.projection:e.projection="pixel"),d(e.zoom)||(e.zoom=1),m(s,l.view.projection,e,i),s.setZoom(e.zoom),!0===e.centerUrlHash){var t=function(){var e,r=h.search();if(u(r.c)){var t=r.c.split(":");3===t.length&&(e={lat:parseFloat(t[0]),lon:parseFloat(t[1]),zoom:parseInt(t[2],10)})}return e};t(),y.$on("$locationChangeSuccess",function(){var r=t();r&&!g(r,i)&&a(y,function(e){e.center.lat=r.lat,e.center.lon=r.lon,e.center.zoom=r.zoom})})}y.$watchCollection("center",function(e){if(e){if(e.projection||(e.projection=l.center.projection),e.autodiscover)return o||(o=new O.Geolocation({projection:O.proj.get(e.projection)})).on("change",function(){if(e.autodiscover){var r=o.getPosition();a(y,function(e){e.center.lat=r[1],e.center.lon=r[0],e.center.zoom=12,e.center.autodiscover=!1,o.setTracking(!1)})}}),void o.setTracking(!0);c(e)||(v.warn("[AngularJS - Openlayers] invalid 'center'"),e=l.center);var r=s.getCenter();if(r)if("pixel"===l.view.projection||"pixel"===e.projection)s.setCenter(e.coord);else{var t=O.proj.transform(r,l.view.projection,e.projection);t[1]===e.lat&&t[0]===e.lon||m(s,l.view.projection,e,i)}s.getZoom()!==e.zoom&&f(s,e.zoom,i)}}),i.on("moveend",function(){a(y,function(e){if(u(e.center)){var r=i.getView().getCenter();if(e.center.zoom=s.getZoom(),"pixel"!==l.view.projection&&"pixel"!==e.center.projection){if(e.center){var t=O.proj.transform(r,l.view.projection,e.center.projection);if(e.center.lat=t[1],e.center.lon=t[0],S.notifyCenterUrlHashChanged(y,e.center,h.search()),p(e.center.bounds)){var o=s.calculateExtent(i.getSize()),n=e.center.projection,a=l.view.projection;e.center.bounds=O.proj.transformExtent(o,a,n)}}}else e.center.coord=r}})})})}}}]),angular.module("openlayers-directive").directive("olLayer",["$log","$q","olMapDefaults","olHelpers",function(e,r,n,a){return{restrict:"E",scope:{properties:"=olLayerProperties",onLayerCreated:"&"},replace:!1,require:"^openlayers",link:function(g,e,r,t){var m=a.isDefined,f=a.equals,o=t.getOpenlayersScope(),y=a.createLayer,v=a.setVectorLayerEvents,h=a.detectLayerType,w=a.createStyle,S=a.isBoolean,x=a.addLayerBeforeMarkers,b=a.isNumber,O=a.insertLayer,j=a.removeLayer,A=a.addLayerToGroup,k=a.removeLayerFromGroup,E=a.getGroup;o.getMap().then(function(s){var c,u=s.getView().getProjection(),p=n.setDefaults(o),d=s.getLayers();if(g.$on("$destroy",function(){g.properties.group?k(d,c,g.properties.group):j(d,c.index),s.removeLayer(c)}),m(g.properties))g.$watch("properties",function(e,r){var t,o,n,a;if(m(e.source)&&m(e.source.type))if(m(e.visible))if(m(e.opacity))if(m(c)){var i=(a=c,function(e){return e!==a});if(m(r)&&!f(e.source,r.source)){var l=c.index;n=d,(o=c.get("group"))&&(n=E(d,o).getLayers()),n.removeAt(l),(c=y(e,u,g.onLayerCreated)).set("group",o),m(c)&&(O(n,l,c),"Vector"===h(e)&&v(p.events,s,g,e.name))}(m(r)&&e.opacity!==r.opacity||i(c))&&(b(e.opacity)||b(parseFloat(e.opacity)))&&c.setOpacity(e.opacity),m(e.index)&&e.index!==c.index&&(n=d,(o=c.get("group"))&&(n=E(d,o).getLayers()),j(n,c.index),O(n,e.index,c)),m(e.group)&&e.group!==r.group&&(k(d,c,r.group),A(d,c,e.group)),(m(r)&&S(e.visible)&&e.visible!==r.visible||i(c))&&c.setVisible(e.visible),(m(e.style)&&!f(e.style,r.style)||i(c))&&(t=angular.isFunction(e.style)?e.style:w(e.style),c.setStyle&&angular.isFunction(c.setStyle)&&c.setStyle(t)),f(e.minResolution,r.minResolution)&&!i(c)||m(e.minResolution)&&c.setMinResolution(e.minResolution),f(e.maxResolution,r.maxResolution)&&!i(c)||m(e.maxResolution)&&c.setMaxResolution(e.maxResolution)}else c=y(e,u,g.onLayerCreated),m(e.group)?A(d,c,e.group):m(e.index)?O(d,e.index,c):x(d,c),"Vector"===h(e)&&v(p.events,s,g,e.name),S(e.visible)&&c.setVisible(e.visible),e.opacity&&c.setOpacity(e.opacity),angular.isArray(e.extent)&&c.setExtent(e.extent),e.style&&(t=angular.isFunction(e.style)?e.style:w(e.style),c.setStyle&&angular.isFunction(c.setStyle)&&c.setStyle(t)),e.minResolution&&c.setMinResolution(e.minResolution),e.maxResolution&&c.setMaxResolution(e.maxResolution);else e.opacity=1;else e.visible=!0},!0);else if(m(r.sourceType)&&m(r.sourceUrl)){var e={name:r.name,source:{url:r.sourceUrl,type:r.sourceType},customAttributes:{uid:r.uid?parseInt(r.uid):0,hidden:!1,area:!0}};c=y(e,u,r.layerName,g.onLayerCreated),"Vector"===h(e)&&v(p.events,s,g,r.name),x(d,c)}})}}}]),angular.module("openlayers-directive").directive("olPath",["$log","$q","olMapDefaults","olHelpers",function(e,r,S,t){return{restrict:"E",scope:{properties:"=olGeomProperties",style:"=olStyle"},require:"^openlayers",replace:!0,template:'<div class="popup-label path" ng-bind-html="message"></div>',link:function(u,p,d,e){var g=t.isDefined,m=t.createFeature,f=t.createOverlay,y=t.createVectorLayer,v=t.insertLayer,h=t.removeLayer,w=e.getOpenlayersScope();w.getMap().then(function(e){var r=S.getDefaults(w),t=r.view.projection,o=y(),n=e.getLayers();if(v(n,n.getLength(),o),u.$on("$destroy",function(){h(n,o.index)}),g(d.coords)){var a=d.proj||"EPSG:4326",i={type:"Polygon",coords:JSON.parse(d.coords),projection:a,style:u.style?u.style:r.styles.path},l=m(i,t);if(o.getSource().addFeature(l),d.message){u.message=d.message;var s=l.getGeometry().getExtent(),c=f(p,s);e.addOverlay(c)}}else;})}}}]),angular.module("openlayers-directive").directive("olView",["$log","$q","olData","olMapDefaults","olHelpers",function(e,r,t,s,c){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(e,r,t,o){var n=o.getOpenlayersScope(),a=c.isNumber,i=c.safeApply,l=c.createView;n.getMap().then(function(r){var e=s.getDefaults(n),t=n.view;t.projection||(t.projection=e.view.projection),t.maxZoom||(t.maxZoom=e.view.maxZoom),t.minZoom||(t.minZoom=e.view.minZoom),t.rotation||(t.rotation=e.view.rotation);var o=l(t);r.setView(o),n.$watchCollection("view",function(e){a(e.rotation)&&o.setRotation(e.rotation)}),o.on("change:rotation",function(){i(n,function(e){e.view.rotation=r.getView().getRotation()})})})}}}]),angular.module("openlayers-directive").directive("olControl",["$log","$q","olData","olMapDefaults","olHelpers",function(e,r,t,o,l){return{restrict:"E",scope:{properties:"=olControlProperties"},replace:!1,require:"^openlayers",link:function(t,e,o,r){var n,a,i=l.isDefined;r.getOpenlayersScope().getMap().then(function(e){var r=(0,l.getControlClasses)();t.$on("$destroy",function(){e.removeControl(n)}),i(t.properties)&&i(t.properties.control)?(n=t.properties.control,e.addControl(n)):o.name&&(i(t.properties)&&(a=t.properties),n=new r[o.name](a),e.addControl(n))})}}}]),angular.module("openlayers-directive").directive("olMarker",["$log","$q","olMapDefaults","olHelpers",function(y,e,v,h){var w=function(){var u=[];function p(e){return u.map(function(e){return e.map}).indexOf(e)}return{getInst:function(e,r,t){var o=p(r);if(-1===o){var n=new O.source.Cluster({source:new O.source.Vector,distance:50}),i=v.getDefaults(t),l=h.createStyle(i.styles.marker),s=h.createStyle(i.styles.cluster),c=h.createStyle(i.styles.selected),a=new O.layer.Vector({source:n,style:function(e){var r=[];if(e.get("features").forEach(function(e){e.get("hidden")||r.push(e)}),1<r.length){var t=null;return t=void 0===(o=angular.copy(i.styles.marker.text))?new O.style.Style({text:new O.style.Text({text:r.length.toString(),offsetY:-32,font:"20px Arial",fill:new O.style.Fill({color:"#000"})})}):new O.style.Style({text:new O.style.Text({text:r.length.toString(),offsetY:o.offsetY,font:o.font,fill:new O.style.Fill({color:o.color})})}),[s,t]}if(1!==r.length)return new O.style.Style;var o,n=r[0].get("selected")?c:l,a=r[0].get("attributes");a.icon&&!r[0].get("selected")&&((o=angular.copy(i.styles.marker)).image.icon.src=a.icon,n=h.createStyle(o));return[n]}});a.set("markers",!0),r.addLayer(a),u.push({map:r,markerLayer:a,instScopes:[]}),o=u.length-1}return u[o].instScopes.push(e),u[o].markerLayer},deregisterScope:function(e,r){var t=p(r);if(-1===t)throw Error("This map has no markers");var o=u[t].instScopes,n=o.indexOf(e);if(-1===n)throw Error("Scope wan't registered");o.splice(n,1),o.length||(r.removeLayer(u[t].markerLayer),delete u[t])}}}();return{restrict:"E",scope:{lat:"=lat",lon:"=lon",uid:"=uid",label:"=label",properties:"=olMarkerProperties",style:"=olStyle"},transclude:!0,require:"^openlayers",replace:!0,template:'<div class="popup-label marker"><div ng-bind-html="message"></div><ng-transclude></ng-transclude></div>',link:function(t,u,o,e){var p=h.isDefined,d=e.getOpenlayersScope(),g=h.createFeature,m=h.createOverlay,f=(h.createStyle,0<u.find("ng-transclude").children().length);d.getMap().then(function(s){var n,a,c,e=w.getInst(t,s,d).getSource(),i={projection:"EPSG:4326",lat:0,lon:0,coord:[],show:!1,showOnMouseOver:!0,showOnMouseClick:!1,keepOneOverlayVisible:!1},r=v.getDefaults(d),l=r.view.projection;if(t.$on("$destroy",function(){e.getSource().removeFeature(c),p(n)&&s.removeOverlay(n),w.deregisterScope(t,s)}),!p(t.properties)){i.lat=t.lat?t.lat:i.lat,i.lon=t.lon?t.lon:i.lon,i.message=o.message,i.style=angular.copy(r.styles.marker),c=g(i,l),p(c)||y.error("[AngularJS - Openlayers] Received invalid data on the marker."),c.set("marker",t),e.getSource().addFeature(c),(i.message||f)&&(t.message=o.message,a=O.proj.transform([i.lon,i.lat],i.projection,l),n=m(u,a),s.addOverlay(n)),c.set("uid",t.uid?+t.uid:0),c.set("uid",t.uid?parseInt(t.uid):0),c.set("hidden",!1),c.set("element",u),c.set("attributes",o),s.getViewport().addEventListener("click",function(l){s.forEachFeatureAtPixel(s.getEventPixel(l),function(e){var r=e.get("features");if(r&&-1<r.indexOf(c)){if(1<r.length){for(var t=O.extent.createEmpty(),o=0,n=r.length;o<n;o++)r.forEach(function(e){e.get("hidden")||(t=O.extent.extend(t,r[o].getGeometry().getExtent()))});var a=O.animation.pan({source:s.getView().getCenter(),duration:200}),i=O.animation.zoom({resolution:s.getView().getResolution(),duration:200});s.beforeRender(a,i),s.getView().fit(t,s.getSize())}1===r.length&&-1<r.indexOf(c)&&u.triggerHandler("click")}l.preventDefault(),l.stopPropagation()})});s.getViewport().addEventListener("mousemove",function(e){var r=!1,t=s.forEachFeatureAtPixel(s.getEventPixel(e),function(e){return e.get("features")}),o=!1;t&&1===t.length&&-1<t.indexOf(c)&&(r=o=!0,p(n)||(a="pixel"===i.projection?i.coord:O.proj.transform([i.lon,i.lat],i.projection,l),n=m(u,a),s.addOverlay(n)),s.getTarget().style.cursor="pointer"),!r&&n&&(o=!0,s.removeOverlay(n),n=void 0,s.getTarget().style.cursor=""),o&&e.preventDefault()}),angular.forEach(s.getOverlays(),function(e){s.removeOverlay(e)})}})}}}]),angular.module("openlayers-directive").service("olData",["$log","$q",function(n,a){var i={},l=function(e,r){var t,o=s(e,r);return angular.isDefined(e[o])&&!0!==e[o].resolvedDefer?t=e[o].defer:(t=a.defer(),e[o]={defer:t,resolvedDefer:!1}),t};function s(e,r){var t,o;if(angular.isDefined(r))t=r;else if(1===Object.keys(e).length)for(o in e)e.hasOwnProperty(o)&&(t=o);else 0===Object.keys(e).length?t="main":n.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the olData.getXXX call");return t}this.setMap=function(e,r){var t;l(i,r).resolve(e),(t=i)[s(t,r)].resolvedDefer=!0},this.getMap=function(e){var r,t,o;return(o=s(r=i,t=e),angular.isDefined(r[o])&&!1!==r[o].resolvedDefer?r[o].defer:l(r,t)).promise},this.resetMap=function(e){angular.isDefined(i[e])&&delete i[e]}}]),angular.module("openlayers-directive").factory("olHelpers",["$q","$log","$http",function(e,f,y){var v=function(e){return angular.isDefined(e)},c=function(e){return angular.isDefined(e)&&null!==e},a=function(o,n,a){o.on(n,function(e){var r=e.coordinate,t=o.getView().getProjection().getCode();"pixel"===t&&(r=r.map(function(e){return parseInt(e,10)})),a.$emit("openlayers.map."+n,{coord:r,projection:t,event:e})})},h=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],r=function(){return{attribution:O.control.Attribution,fullscreen:O.control.FullScreen,mouseposition:O.control.MousePosition,overviewmap:O.control.OverviewMap,rotate:O.control.Rotate,scaleline:O.control.ScaleLine,zoom:O.control.Zoom,zoomslider:O.control.ZoomSlider,zoomtoextent:O.control.ZoomToExtent}},w=["osm","sat","hyb"],S=["World_Imagery","World_Street_Map","World_Topo_Map","World_Physical_Map","World_Terrain_Base","Ocean_Basemap","NatGeo_World_Map"],u={style:O.style.Style,fill:O.style.Fill,stroke:O.style.Stroke,circle:O.style.Circle,icon:O.style.Icon,image:O.style.Image,regularshape:O.style.RegularShape,text:O.style.Text},p=function(e,r){return r&&e instanceof r?e:r?new r(e):e},i=function n(e,a){var i,l;if(i=a?e[a]:(a="style",e),"style"===a&&e instanceof Function)return e;if(!(i instanceof Object))return i;if("[object Object]"===Object.prototype.toString.call(i)){l={};var s=u[a];if(s&&i instanceof s)return i;Object.getOwnPropertyNames(i).forEach(function(e,r,t){var o=u[e];if(s&&o&&o.prototype instanceof u[a])return console.assert(1===t.length,"Extra parameters for "+a),l=n(i,e),p(l,o);l[e]=n(i,e),"text"!==e&&"string"!=typeof l[e]&&(l[e]=p(l[e],u[e]))})}else l=i;return p(l,u[a])},d=function(e){if(e.type)return e.type;switch(e.source.type){case"ImageWMS":case"ImageStatic":return"Image";case"GeoJSON":case"JSONP":case"TopoJSON":case"KML":return"Vector";case"TileVector":return"TileVector";default:return"Tile"}},x=function(e){var r=e;if(e&&"object"==typeof e)for(var t in r="[object Array]"===Object.prototype.toString.call(e)?[]:{},e)r[t]=x(e[t]);return r},b=function(e){var r=[];return v(e.attribution)&&r.unshift(new O.Attribution({html:e.attribution})),r},l=function(e,r){var t;return angular.forEach(e,function(e){e instanceof O.layer.Group&&e.get("name")===r&&(t=e)}),t},s=function(e,r){for(var t,o=0;o<e.getLength();o++){if(e.item(o).get("markers")){t=o;break}}if(v(t)){var n=e.item(t);r.index=t,e.setAt(t,r),n.index=e.getLength(),e.push(n)}else r.index=e.getLength(),e.push(r)},n=function(e,r){e.removeAt(r);for(var t=r;t<e.getLength();t++){var o=e.item(t);if(null===o){e.insertAt(t,null);break}o.index=t}};return{isDefined:v,isNumber:function(e){return angular.isNumber(e)},createView:function(e){var r={projection:function(e){var r;switch(e.projection){case"pixel":if(!v(e.extent))return void f.error("[AngularJS - Openlayers] - You must provide the extent of the image if using pixel projection");r=new O.proj.Projection({code:"pixel",units:"pixels",extent:e.extent});break;default:r=new O.proj.get(e.projection)}return r}(e),maxZoom:e.maxZoom,minZoom:e.minZoom};return e.center&&(r.center=e.center),e.extent&&(r.extent=e.extent),e.zoom&&(r.zoom=e.zoom),e.resolutions&&(r.resolutions=e.resolutions),new O.View(r)},isDefinedAndNotNull:c,isString:function(e){return angular.isString(e)},isArray:function(e){return angular.isArray(e)},isObject:function(e){return angular.isObject(e)},equals:function(e,r){return angular.equals(e,r)},isValidCenter:function(e){return angular.isDefined(e)&&("boolean"==typeof e.autodiscover||angular.isNumber(e.lat)&&angular.isNumber(e.lon)||angular.isArray(e.coord)&&2===e.coord.length&&angular.isNumber(e.coord[0])&&angular.isNumber(e.coord[1])||angular.isArray(e.bounds)&&4===e.bounds.length&&angular.isNumber(e.bounds[0])&&angular.isNumber(e.bounds[1])&&angular.isNumber(e.bounds[1])&&angular.isNumber(e.bounds[2]))},safeApply:function(e,r){var t=e.$root.$$phase;"$apply"===t||"$digest"===t?e.$eval(r):e.$apply(r)},isSameCenterOnMap:function(e,r){var t=e.projection||"EPSG:4326",o=[e.lon,e.lat],n=r.getView().getProjection(),a=O.proj.transform(r.getView().getCenter(),n,t),i=r.getView().getZoom();return a[1].toFixed(4)===o[1].toFixed(4)&&a[0].toFixed(4)===o[0].toFixed(4)&&i===e.zoom},setCenter:function(e,r,t,o){if(o&&e.getCenter()){var n=O.animation.pan({duration:150,source:e.getCenter()});o.beforeRender(n)}if(t.projection===r)e.setCenter([t.lon,t.lat]);else{var a=[t.lon,t.lat];e.setCenter(O.proj.transform(a,t.projection,r))}},setZoom:function(e,r,t){var o=O.animation.zoom({duration:150,resolution:t.getView().getResolution()});t.beforeRender(o),e.setZoom(r)},isBoolean:function(e){return"boolean"==typeof e},createStyle:i,setMapEvents:function(e,r,t){if(v(e)&&angular.isArray(e.map))for(var o in e.map){var n=e.map[o];a(r,n,t)}},setVectorLayerEvents:function(e,n,a,i){v(e)&&angular.isArray(e.layers)&&angular.forEach(e.layers,function(o){angular.element(n.getViewport()).on(o,function(e){var r=n.getEventPixel(e),t=n.forEachFeatureAtPixel(r,function(e,r){return c(r)&&r.get("name")===i?e:null});c(t)&&a.$emit("openlayers.layers."+i+"."+o,t,e)})})},setViewEvents:function(e,r,t){if(v(e)&&angular.isArray(e.view)){var o=r.getView();angular.forEach(e.view,function(r){o.on(r,function(e){t.$emit("openlayers.view."+r,o,e)})})}},detectLayerType:d,createLayer:function(e,r,t,o){var n,a=d(e),i=function(n,e){var r,t,o,a=new O.format.GeoJSON;switch(n.type){case"MapBox":if(!n.mapId||!n.accessToken)return void f.error("[AngularJS - Openlayers] - MapBox layer requires the map id and the access token");t="http://api.tiles.mapbox.com/v4/"+n.mapId+"/{z}/{x}/{y}.png?access_token="+n.accessToken;var i=window.devicePixelRatio;1<i&&(t=t.replace(".png","@2x.png")),r=new O.source.XYZ({url:t,attributions:b(n),tilePixelRatio:1<i?2:1});break;case"MapBoxStudio":if(!n.mapId||!n.accessToken||!n.userId)return void f.error("[AngularJS - Openlayers] - MapBox Studio layer requires the map id, user id  and the access token");t="https://api.mapbox.com/styles/v1/"+n.userId+"/"+n.mapId+"/tiles/{z}/{x}/{y}?access_token="+n.accessToken,r=new O.source.XYZ({url:t,attributions:b(n),tileSize:n.tileSize||[512,512]});break;case"ImageWMS":n.url&&n.params||f.error("[AngularJS - Openlayers] - ImageWMS Layer needs valid server url and params properties"),r=new O.source.ImageWMS({url:n.url,attributions:b(n),crossOrigin:void 0===n.crossOrigin?"anonymous":n.crossOrigin,params:x(n.params),ratio:n.ratio});break;case"TileWMS":(n.url||n.urls)&&n.params||f.error("[AngularJS - Openlayers] - TileWMS Layer needs valid url (or urls) and params properties");var l={crossOrigin:void 0===n.crossOrigin?"anonymous":n.crossOrigin,params:x(n.params),attributions:b(n)};n.serverType&&(l.serverType=n.serverType),n.url&&(l.url=n.url),n.urls&&(l.urls=n.urls),r=new O.source.TileWMS(l);break;case"WMTS":(n.url||n.urls)&&n.tileGrid||f.error("[AngularJS - Openlayers] - WMTS Layer needs valid url (or urls) and tileGrid properties");var s={projection:e,layer:n.layer,attributions:b(n),matrixSet:"undefined"===n.matrixSet?e:n.matrixSet,format:"undefined"===n.format?"image/jpeg":n.format,requestEncoding:"undefined"===n.requestEncoding?"KVP":n.requestEncoding,tileGrid:new O.tilegrid.WMTS({origin:n.tileGrid.origin,resolutions:n.tileGrid.resolutions,matrixIds:n.tileGrid.matrixIds}),style:"undefined"===n.style?"normal":n.style};v(n.url)&&(s.url=n.url),v(n.urls)&&(s.urls=n.urls),r=new O.source.WMTS(s);break;case"OSM":r=new O.source.OSM({attributions:b(n)}),n.url&&r.setUrl(n.url);break;case"BingMaps":if(!n.key)return void f.error("[AngularJS - Openlayers] - You need an API key to show the Bing Maps.");var c={key:n.key,attributions:b(n),imagerySet:n.imagerySet?n.imagerySet:h[0],culture:n.culture};n.maxZoom&&(c.maxZoom=n.maxZoom),r=new O.source.BingMaps(c);break;case"MapQuest":if(!n.layer||-1===w.indexOf(n.layer))return void f.error("[AngularJS - Openlayers] - MapQuest layers needs a valid 'layer' property.");r=new O.source.MapQuest({attributions:b(n),layer:n.layer});break;case"EsriBaseMaps":if(!n.layer||-1===S.indexOf(n.layer))return void f.error("[AngularJS - Openlayers] - ESRI layers needs a valid 'layer' property.");var u="http://services.arcgisonline.com/ArcGIS/rest/services/"+n.layer+"/MapServer/tile/{z}/{y}/{x}";r=new O.source.XYZ({attributions:b(n),url:u});break;case"GeoJSON":if(!n.geojson&&!n.url)return void f.error("[AngularJS - Openlayers] - You need a geojson property to add a GeoJSON layer.");if(v(n.url))r=new O.source.Vector({format:new O.format.GeoJSON,url:n.url});else{r=new O.source.Vector;var p,d=e;p=v(n.geojson.projection)?new O.proj.get(n.geojson.projection):e;var g=a.readFeatures(n.geojson.object,{featureProjection:d,dataProjection:p});r.addFeatures(g)}break;case"JSONP":if(!n.url)return void f.error("[AngularJS - Openlayers] - You need an url properly configured to add a JSONP layer.");v(n.url)&&(r=new O.source.ServerVector({format:a,loader:function(){var e=n.url+"&outputFormat=text/javascript&format_options=callback:JSON_CALLBACK";y.jsonp(e,{cache:n.cache}).success(function(e){r.addFeatures(a.readFeatures(e))}).error(function(e){f(e)})},projection:e}));break;case"TopoJSON":if(!n.topojson&&!n.url)return void f.error("[AngularJS - Openlayers] - You need a topojson property to add a TopoJSON layer.");r=n.url?new O.source.Vector({format:new O.format.TopoJSON,url:n.url}):new O.source.Vector(angular.extend(n.topojson,{format:new O.format.TopoJSON}));break;case"TileJSON":r=new O.source.TileJSON({url:n.url,attributions:b(n),crossOrigin:"anonymous"});break;case"TileVector":n.url&&n.format||f.error("[AngularJS - Openlayers] - TileVector Layer needs valid url and format properties"),r=new O.source.VectorTile({url:n.url,projection:e,attributions:b(n),format:n.format,tileGrid:new O.tilegrid.createXYZ({maxZoom:n.maxZoom||19})});break;case"TileTMS":n.url&&n.tileGrid||f.error("[AngularJS - Openlayers] - TileTMS Layer needs valid url and tileGrid properties"),r=new O.source.TileImage({url:n.url,maxExtent:n.maxExtent,attributions:b(n),tileGrid:new O.tilegrid.TileGrid({origin:n.tileGrid.origin,resolutions:n.tileGrid.resolutions}),tileUrlFunction:function(e){var r=e[0],t=e[1],o=e[2];return t<0||o<0?"":n.url+r+"/"+t+"/"+o+".png"}});break;case"TileImage":r=new O.source.TileImage({url:n.url,attributions:b(n),tileGrid:new O.tilegrid.TileGrid({origin:n.tileGrid.origin,resolutions:n.tileGrid.resolutions}),tileUrlFunction:function(e){var r=e[0],t=e[1],o=-e[2]-1;return n.url.replace("{z}",r.toString()).replace("{x}",t.toString()).replace("{y}",o.toString())}});break;case"KML":var m=n.extractStyles||!1;r=new O.source.Vector({url:n.url,format:new O.format.KML,radius:n.radius,extractStyles:m});break;case"Stamen":if(!n.layer||(o=n.layer,-1===["watercolor","terrain","toner"].indexOf(o)))return void f.error("[AngularJS - Openlayers] - You need a valid Stamen layer.");r=new O.source.Stamen({layer:n.layer});break;case"ImageStatic":if(!n.url||!angular.isArray(n.imageSize)||2!==n.imageSize.length)return void f.error("[AngularJS - Openlayers] - You need a image URL to create a ImageStatic layer.");r=new O.source.ImageStatic({url:n.url,attributions:b(n),imageSize:n.imageSize,projection:e,imageExtent:n.imageExtent?n.imageExtent:e.getExtent(),imageLoadFunction:n.imageLoadFunction});break;case"XYZ":n.url||n.tileUrlFunction||f.error("[AngularJS - Openlayers] - XYZ Layer needs valid url or tileUrlFunction properties"),r=new O.source.XYZ({url:n.url,attributions:b(n),minZoom:n.minZoom,maxZoom:n.maxZoom,projection:n.projection,tileUrlFunction:n.tileUrlFunction});break;case"Zoomify":n.url&&angular.isArray(n.imageSize)&&2===n.imageSize.length||f.error("[AngularJS - Openlayers] - Zoomify Layer needs valid url and imageSize properties"),r=new O.source.Zoomify({url:n.url,size:n.imageSize})}return r||f.warn('[AngularJS - Openlayers] - No source could be found for type "'+n.type+'"'),r}(e.source,r);if(i){"function"!=typeof t||o||(o=t,t=void 0),"Vector"===a&&e.clustering&&(i=new O.source.Cluster({source:i,distance:e.clusteringDistance}));var l={source:i};switch(c(e.opacity)&&(l.opacity=e.opacity),c(e.visible)&&(l.visible=e.visible),c(e.extent)&&(l.extent=e.extent),c(e.zIndex)&&(l.zIndex=e.zIndex),c(e.minResolution)&&(l.minResolution=e.minResolution),c(e.maxResolution)&&(l.maxResolution=e.maxResolution),a){case"Image":n=new O.layer.Image(l);break;case"Tile":n=new O.layer.Tile(l);break;case"Heatmap":n=new O.layer.Heatmap(l);break;case"Vector":n=new O.layer.Vector(l);break;case"TileVector":n=new O.layer.VectorTile(l)}if(v(t)?n.set("name",t):v(e.name)&&n.set("name",e.name),v(e.customAttributes))for(var s in e.customAttributes)n.set(s,e.customAttributes[s]);return i.once("change",function(){"ready"===i.getState()&&o&&o({oLayer:n})}),n}},createVectorLayer:function(){return new O.layer.Vector({source:new O.source.Vector})},notifyCenterUrlHashChanged:function(e,r,t){if(r.centerUrlHash){var o=r.lat.toFixed(4)+":"+r.lon.toFixed(4)+":"+r.zoom;v(t.c)&&t.c===o||e.$emit("centerUrlHash",o)}},getControlClasses:r,detectControls:function(e){var t={},o=r();return e.forEach(function(e){for(var r in o)e instanceof o[r]&&(t[r]=e)}),t},createFeature:function(e,r){var t;switch(e.type){case"Polygon":t=new O.geom.Polygon(e.coords);break;default:t=v(e.coord)&&"pixel"===e.projection?new O.geom.Point(e.coord):new O.geom.Point([e.lon,e.lat])}v(e.projection)&&"pixel"!==e.projection&&(t=t.transform(e.projection,r));var o=new O.Feature({geometry:t});if(v(e.style)){var n=i(e.style);o.setStyle(n)}return o},addLayerBeforeMarkers:s,getGroup:l,addLayerToGroup:function(e,r,t){var o,n,a=l(e,t);v(a)||(o=t,(n=new O.layer.Group).set("name",o),s(e,a=n)),r.set("group",t),s(a.getLayers(),r)},removeLayerFromGroup:function(e,r,t){var o=l(e,t);r.set("group"),n(o.getLayers(),r.index)},removeLayer:n,insertLayer:function(e,r,t){if(e.getLength()<r){for(;e.getLength()<r;){var o=new O.layer.Image;o.index=e.getLength(),e.push(o)}t.index=r,e.push(t)}else{t.index=r,e.insertAt(t.index,t);for(var n=r+1;n<e.getLength();n++){var a=e.item(n);if(null===a){e.removeAt(n);break}a.index=n}}},createOverlay:function(e,r){return e.css("display","block"),new O.Overlay({position:r,element:e[0],positioning:"center-left"})}}}]),angular.module("openlayers-directive").factory("olMapDefaults",["$q","olHelpers",function(e,r){var n=r.isDefined,a={};return{getDefaults:function(e){if(!n(e))for(var r in a)return a[r];return a[e.$id]},setDefaults:function(e){var r=e.defaults,t=e.$id,o={view:{projection:"EPSG:3857",minZoom:void 0,maxZoom:void 0,rotation:0,extent:void 0},center:{lat:0,lon:0,zoom:1,autodiscover:!1,bounds:[],centerUrlHash:!1,projection:"EPSG:4326"},styles:{path:{stroke:{color:"blue",width:8}},marker:{image:new O.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:"data:image/png;base64,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"})}},events:{map:[],markers:[],layers:[]},controls:{attribution:!0,rotate:!1,zoom:!0},interactions:{mouseWheelZoom:!1},renderer:"canvas"};return n(r)&&(n(r.layers)&&(o.layers=angular.copy(r.layers)),n(r.controls)&&(o.controls=angular.copy(r.controls)),n(r.events)&&(o.events=angular.copy(r.events)),n(r.interactions)&&(o.interactions=angular.copy(r.interactions)),n(r.renderer)&&(o.renderer=r.renderer),n(r.view)&&(o.view.maxZoom=r.view.maxZoom||o.view.maxZoom,o.view.minZoom=r.view.minZoom||o.view.minZoom,o.view.projection=r.view.projection||o.view.projection,o.view.extent=r.view.extent||o.view.extent,o.view.resolutions=r.view.resolutions||o.view.resolutions),n(r.styles)&&(o.styles=angular.extend(o.styles,r.styles)),n(r.loadTilesWhileAnimating)&&(o.loadTilesWhileAnimating=r.loadTilesWhileAnimating),n(r.loadTilesWhileInteracting)&&(o.loadTilesWhileInteracting=r.loadTilesWhileInteracting)),a[t]=o}}}])});